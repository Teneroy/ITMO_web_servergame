{"version":3,"file":"game.js","sourceRoot":"","sources":["../../../sources/client/screens/game.ts"],"names":[],"mappings":"AAKA,IAAK,gBAGJ;AAHD,WAAK,gBAAgB;IACpB,qEAAe,CAAA;IACf,uEAAgB,CAAA;AACjB,CAAC,EAHI,gBAAgB,KAAhB,gBAAgB,QAGpB;AAED,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAE,cAAc,CAAwB,CAAC;AAE7E,MAAM,WAAW,GAAoB;IACpC,OAAO,EAAE,KAAK;IACd,IAAI,EAAE;QACL,GAAG,EAAE,CAAC;QACN,GAAG,EAAE,CAAC;KACN;IACD,EAAE,EAAE;QACH,GAAG,EAAE,CAAC;QACN,GAAG,EAAE,CAAC;KACN;IACD,KAAK,EAAE,EAAE;CACT,CAAC;AAKF,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAqB,CAAC;AAE7E,IAAK,CAAC,KAAK,EACX;IACC,MAAM,IAAI,KAAK,CAAE,gDAAgD,CAAE,CAAC;CACpE;AAKD,QAAQ,CAAC,UAAU,CAAC,CAAC;AAErB,SAAS,EAAE,CAAC;AAUZ,IAAI,WAAwB,CAAC;AAO7B,SAAS,QAAQ,CAAC,UAAwB;IAEzC,IAAI,eAAe,GAAW,EAAE,CAAC;IACjC,MAAM,QAAQ,GAAmB,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;IAC1E,IAAI,EAAE,GAAW,EAAE,CAAC;IACpB,IAAI,EAAE,GAAW,EAAE,CAAC;IACpB,KAAI,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;QACnC,eAAe,IAAI,mBAAmB,CAAC;QACvC,KAAI,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YACnC,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,oBAAoB,GAAG,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAC5D,EAAE,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,oBAAoB,GAAG,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;YAC1E,eAAe,IAAI,CAAC,uBAAuB,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC,GAAG,QAAQ,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,QAAQ,CAAC,CAAC;SACtJ;QACD,eAAe,IAAI,QAAQ,CAAC;KAC5B;IACD,UAAU,CAAC,SAAS,GAAG,eAAe,CAAC;AACxC,CAAC;AAED,SAAS,SAAS;IAEjB,KAAK,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAG;QACrC,KAAI,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YAEnC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,gBAAgB,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;SAC1E;KACD;AACF,CAAC;AAOD,SAAS,OAAO,CAAE,KAAY;IAE7B,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;IACzB,MAAM,IAAI,GAAG,KAAK,CAAC,MAAqB,CAAC;IACzC,IAAI,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC5B,IAAI,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,WAAW,CAAC,CAAC;IAC5D,IAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;IAC/B,IAAG,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,CAAC,WAAW,CAAC,KAAK,IAAI,OAAO,IAAI,QAAQ,IAAI,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,IAAI,OAAO,IAAI,QAAQ,IAAI,WAAW,CAAC,CAAC;QAClJ,OAAO;IACR,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAClB,IAAG,CAAC,CAAC,WAAW,CAAC,OAAO,IAAI,CAAE,CAAC,WAAW,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,QAAQ,CAAE,CAAC,IAAI,CAAC,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,gBAAgB,CAAC,YAAY,CAAC,CAAC;QACxJ,OAAO;IACR,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;IAClB,IAAG,CAAC,WAAW,CAAC,OAAO,EACvB;QACC,WAAW,CAAC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACrC,WAAW,CAAC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACrC,WAAW,CAAC,OAAO,GAAG,IAAI,CAAC;QAC3B,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QACzB,OAAO;KACP;IACD,WAAW,CAAC,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACnC,WAAW,CAAC,EAAE,CAAC,GAAG,GAAG,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACnC,WAAW,CAAC,OAAO,GAAG,KAAK,CAAC;IAC5B,WAAW,IAAI,WAAW,CAAE,WAAW,CAAE,CAAC;AAC3C,CAAC;AAQD,SAAS,SAAS,CAAC,GAAW,EAAE,GAAW,EAAE,IAAY;IAExD,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;IACnC,MAAM,IAAI,GAAG,QAAQ,CAAC,cAAc,CAAC,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,CAAC,CAAgB,CAAC;IACvE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC7B,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;IACvD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;AACjF,CAAC;AAED,SAAS,WAAW,CAAC,KAA2B;IAE/C,KAAK,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAG;QACrC,KAAI,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YACnC,IAAG,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,KAAK,EAAE;gBAC5B,SAAS;YACV,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;SACrC;KACD;AACF,CAAC;AAED,SAAS,UAAU;IAElB,KAAK,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;QACpC,KAAI,IAAI,CAAC,GAAW,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YAEnC,QAAQ,CAAC,cAAc,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,WAAW,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC;SAC9G;KACD;AACF,CAAC;AAWD,SAAS,MAAM,CAAE,MAAe,EAAE,SAA+B,EAAE,KAAa;IAE/E,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;IACvB,UAAU,EAAE,CAAC;IACb,WAAW,CAAC,SAAS,CAAC,CAAC;IACvB,WAAW,CAAC,KAAK,GAAG,KAAK,CAAC;IAC1B,IAAK,MAAM,EACX;QACC,KAAK,CAAC,WAAW,GAAG,SAAS,CAAC;QAC9B,OAAO;KACP;IACD,KAAK,CAAC,WAAW,GAAG,gBAAgB,CAAC;AACtC,CAAC;AAOD,SAAS,cAAc,CAAE,OAAoB;IAE5C,WAAW,GAAG,OAAO,CAAC;AACvB,CAAC;AAED,OAAO,EACN,MAAM,EACN,cAAc,GACd,CAAC","sourcesContent":["/**\r\n * Заголовок экрана\r\n */\r\nimport { PlayerGameState } from \"../../common/messages\";\r\n\r\nenum ClassesPositions {\r\n\tCOLOR_CONST = 5,\r\n\tFIGURE_CONST = 4\r\n}\r\n\r\nconst title = document.querySelector( 'main.game h2' ) as HTMLHeadingElement;\r\n\r\nconst playerState: PlayerGameState = {\r\n\tclicked: false,\r\n\tfrom: {\r\n\t\trow: 0,\r\n\t\tcol: 0\r\n\t},\r\n\tto: {\r\n\t\trow: 0,\r\n\t\tcol: 0\r\n\t},\r\n\tcolor: ''\r\n};\r\n\r\n/**\r\n * Игровая доска\r\n */\r\nconst chessboard = document.querySelector('.chessboard') as HTMLInputElement;\r\n\r\nif ( !title )\r\n{\r\n\tthrow new Error( 'Can\\'t find required elements on \"game\" screen' );\r\n}\r\n\r\n/**\r\n * Генерируем доску\r\n */\r\ngenerate(chessboard);\r\n\r\naddEvents();\r\n\r\n/**\r\n * Обработчик хода игрока\r\n */\r\ntype TurnHandler = (move: PlayerGameState) => void;\r\n\r\n/**\r\n * Обработчик хода игрока\r\n */\r\nlet turnHandler: TurnHandler;\r\n\r\n\r\n/**\r\n * Генерирует доску\r\n * @param chessboard игровая доска\r\n */\r\nfunction generate(chessboard : HTMLElement): void\r\n{\r\n\tlet temp_chessboard: string = '';\r\n\tconst lib_char: Array<string>  = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\r\n\tlet lt: string = '';\r\n\tlet nm: string = '';\r\n\tfor(let i: number = 8; i >= 1; i--) {\r\n\t\ttemp_chessboard += '<div class=\"row\">';\r\n\t\tfor(let j: number = 1; j <= 8; j++) {\r\n\t\t\tnm = (j == 1 ? ('<span class=\"num\">' + i + '</span>') : '');\r\n\t\t\tlt = (i == 1 ? ('<span class=\"let\">' + lib_char[j - 1] + '</span>') : '');\r\n\t\t\ttemp_chessboard += ('<div class=\"col part ' + ((i + j) % 2 == 0 ? 'colored' : 'uncolored') + '\" id=\"' + i + '_' + j + '\">' + nm + '' + lt + '</div>');\r\n\t\t}\r\n\t\ttemp_chessboard += '</div>';\r\n\t}\r\n\tchessboard.innerHTML = temp_chessboard;\r\n}\r\n\r\nfunction addEvents(): void\r\n{\r\n\tfor (let i: number = 1; i <= 8; i++ ) {\r\n\t\tfor(let j: number = 1; j <= 8; j++) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tdocument.getElementById((i + '_' + j)).addEventListener('click', onClick);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Обрабатывает нажатие на клетку\r\n *\r\n * @param event\r\n */\r\nfunction onClick( event: Event ): void\r\n{\r\n\tconsole.log(playerState);\r\n\tconst cell = event.target as HTMLElement;\r\n\tlet id = cell.id.split('_');\r\n\tlet colorFig = cell.classList[ClassesPositions.COLOR_CONST];\r\n\tlet classlist = cell.classList;\r\n\tif(!playerState.clicked && ((playerState.color == 'white' && colorFig == 'black-fig') || (playerState.color == 'black' && colorFig == 'white-fig')) )\r\n\t\treturn;\r\n\tconsole.log('f1');\r\n\tif((!playerState.clicked && ( (playerState.color + '-fig') != colorFig )) || (!playerState.clicked && (classlist.length < ClassesPositions.FIGURE_CONST)))\r\n\t\treturn;\r\n\tconsole.log('f2');\r\n\tif(!playerState.clicked)\r\n\t{\r\n\t\tplayerState.from.row = Number(id[0]);\r\n\t\tplayerState.from.col = Number(id[1]);\r\n\t\tplayerState.clicked = true;\r\n\t\tconsole.log(playerState);\r\n\t\treturn;\r\n\t}\r\n\tplayerState.to.row = Number(id[0]);\r\n\tplayerState.to.col = Number(id[1]);\r\n\tplayerState.clicked = false;\r\n\tturnHandler && turnHandler( playerState );\r\n}\r\n\r\n/**\r\n * Генерирует доску\r\n * @param row позиция по y\r\n * @param col позиция по x\r\n * @param type фигура\r\n */\r\nfunction addfigure(row: number, col: number, type: string): void\r\n{\r\n\tconsole.log(type[type.length - 1]);\r\n\tconst cell = document.getElementById((row + '_' + col)) as HTMLElement;\r\n\tcell.classList.add('figure');\r\n\tcell.classList.add(type.substring(0, type.length - 1));\r\n\tcell.classList.add((type[type.length - 1] === 'W' ? 'white-fig' : 'black-fig'));\r\n}\r\n\r\nfunction renderField(field: Array<Array<string>>): void\r\n{\r\n\tfor (let i: number = 1; i <= 8; i++ ) {\r\n\t\tfor(let j: number = 1; j <= 8; j++) {\r\n\t\t\tif(field[i - 1][j - 1] === '')\r\n\t\t\t\tcontinue;\r\n\t\t\taddfigure(i, j, field[i - 1][j - 1]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction clearField(): void\r\n{\r\n\tfor (let i: number = 8; i >= 1; i--) {\r\n\t\tfor(let j: number = 1; j <= 8; j++) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tdocument.getElementById((i + '_' + j)).className = 'col part ' + ((i + j) % 2 == 0 ? 'colored' : 'uncolored');\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\n/**\r\n * Обновляет экран игры\r\n *\r\n * @param myTurn Ход текущего игрока?\r\n * @param gameField игровое поле\r\n * @param color\r\n */\r\nfunction update( myTurn: boolean, gameField: Array<Array<string>>, color: string ): void\r\n{\r\n\tconsole.log(gameField);\r\n\tclearField();\r\n\trenderField(gameField);\r\n\tplayerState.color = color;\r\n\tif ( myTurn )\r\n\t{\r\n\t\ttitle.textContent = 'Ваш ход';\r\n\t\treturn;\r\n\t}\r\n\ttitle.textContent = 'Ход противника';\r\n}\r\n\r\n/**\r\n * Устанавливает обработчик хода игрока\r\n *\r\n * @param handler Обработчик хода игрока\r\n */\r\nfunction setTurnHandler( handler: TurnHandler ): void\r\n{\r\n\tturnHandler = handler;\r\n}\r\n\r\nexport {\r\n\tupdate,\r\n\tsetTurnHandler,\r\n};\r\n"]}